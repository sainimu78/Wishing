å¦‚ä½•ä½¿ç”¨ STL è·å–æ–‡ä»¶çš„ç¼–ç , å¹¶å¤„ç†è·å–ç¼–ç çš„æ¥æºæ–‡ä»¶, å†™å…¥å¤„ç†åçš„æ•°æ®ä¿æŒç¼–ç ä¸å˜



ğŸ¤–



åœ¨ C++ ä¸­ä½¿ç”¨æ ‡å‡†åº“ï¼ˆSTLï¼‰æ¥å¤„ç†æ–‡ä»¶çš„ç¼–ç å¹¶ä¿æŒç¼–ç ä¸å˜æ˜¯ä¸€ä¸ªæœ‰äº›å¤æ‚çš„ä»»åŠ¡ï¼Œå› ä¸º STL æœ¬èº«å¹¶æ²¡æœ‰ç›´æ¥æä¾›å¤„ç†æ–‡ä»¶ç¼–ç çš„åŠŸèƒ½ã€‚é€šå¸¸éœ€è¦ç»“åˆå…¶ä»–åº“ï¼ˆå¦‚ ICUã€Boost.Locale æˆ–è€… iconvï¼‰æ¥å¤„ç†ç¼–ç æ£€æµ‹å’Œè½¬æ¢ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å‡è®¾æ–‡ä»¶ç¼–ç å·²çŸ¥æˆ–è€…å¯ä»¥é€šè¿‡å…¶ä»–å·¥å…·é¢„å…ˆç¡®å®šç¼–ç ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ STL æ¥è¯»å–å’Œå†™å…¥æ–‡ä»¶ï¼ŒåŒæ—¶ä¿æŒç¼–ç ä¸å˜ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•è¯»å–å’Œå†™å…¥æ–‡ä»¶ï¼ŒåŒæ—¶ä¿æŒæ–‡ä»¶çš„ç¼–ç ä¸å˜ï¼š

### å‡è®¾æ–‡ä»¶ç¼–ç ä¸º UTF-8

1. **è¯»å–æ–‡ä»¶å†…å®¹**ï¼š

```
Cpp1#include <iostream>
2#include <fstream>
3#include <string>
4#include <vector>
5
6std::vector<char> readFile(const std::string& filename) {
7    std::ifstream file(filename, std::ios::binary);
8    if (!file) {
9        throw std::runtime_error("Could not open file for reading");
10    }
11
12    // è¯»å–æ–‡ä»¶å†…å®¹åˆ°ç¼“å†²åŒº
13    std::vector<char> buffer((std::istreambuf_iterator<char>(file)), std::istreambuf_iterator<char>());
14    return buffer;
15}
```

1. **å¤„ç†æ–‡ä»¶å†…å®¹**ï¼š

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å‡è®¾å¤„ç†æ–‡ä»¶å†…å®¹çš„æ“ä½œæ˜¯ç®€å•çš„ï¼Œä¾‹å¦‚å°†å†…å®¹è½¬æ¢ä¸ºå¤§å†™å­—æ¯ã€‚å¤„ç†å†…å®¹æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿å¤„ç†åçš„å†…å®¹ä»ç„¶æ˜¯ UTF-8 ç¼–ç ã€‚

```
Cpp1#include <algorithm>
2#include <cctype>
3
4void processContent(std::vector<char>& content) {
5    // å°†å†…å®¹è½¬æ¢ä¸ºå¤§å†™
6    std::transform(content.begin(), content.end(), content.begin(), [](unsigned char c) {
7        return std::toupper(c);
8    });
9}
```

1. **å†™å…¥å¤„ç†åçš„å†…å®¹**ï¼š

```
Cpp1void writeFile(const std::string& filename, const std::vector<char>& content) {
2    std::ofstream file(filename, std::ios::binary);
3    if (!file) {
4        throw std::runtime_error("Could not open file for writing");
5    }
6
7    file.write(content.data(), content.size());
8}
```

1. **ä¸»å‡½æ•°**ï¼š

```
Cpp1int main() {
2    try {
3        std::string filename = "example.txt";
4
5        // è¯»å–æ–‡ä»¶
6        std::vector<char> content = readFile(filename);
7
8        // å¤„ç†æ–‡ä»¶å†…å®¹
9        processContent(content);
10
11        // å†™å…¥å¤„ç†åçš„å†…å®¹
12        writeFile("processed_" + filename, content);
13
14        std::cout << "File processed and written successfully." << std::endl;
15    } catch (const std::exception& e) {
16        std::cerr << "Error: " << e.what() << std::endl;
17    }
18
19    return 0;
20}
```

### æ³¨æ„äº‹é¡¹

1. **ç¼–ç æ£€æµ‹**ï¼šå¦‚æœæ–‡ä»¶ç¼–ç æœªçŸ¥ï¼Œå¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚ ICU æˆ– Boost.Localeï¼‰æ¥æ£€æµ‹æ–‡ä»¶ç¼–ç ã€‚
2. **ç¼–ç è½¬æ¢**ï¼šå¦‚æœéœ€è¦åœ¨ä¸åŒç¼–ç ä¹‹é—´è½¬æ¢ï¼Œå¯ä»¥ä½¿ç”¨ `iconv` æˆ–å…¶ä»–ç¼–ç è½¬æ¢åº“ã€‚
3. **å¤„ç†å†…å®¹**ï¼šç¡®ä¿å¤„ç†å†…å®¹çš„æ“ä½œä¸ä¼šç ´åç¼–ç ã€‚ä¾‹å¦‚ï¼Œå¤„ç† UTF-8 æ–‡ä»¶æ—¶ï¼Œæ“ä½œåº”å½“åœ¨å­—ç¬¦å±‚é¢è¿›è¡Œï¼Œè€Œä¸æ˜¯å­—èŠ‚å±‚é¢ã€‚
4. **äºŒè¿›åˆ¶æ¨¡å¼**ï¼šè¯»å–å’Œå†™å…¥æ–‡ä»¶æ—¶ä½¿ç”¨äºŒè¿›åˆ¶æ¨¡å¼ï¼ˆ`std::ios::binary`ï¼‰ï¼Œä»¥ç¡®ä¿æ–‡ä»¶å†…å®¹ä¸è¢«æ„å¤–ä¿®æ”¹ï¼ˆä¾‹å¦‚æ¢è¡Œç¬¦è½¬æ¢ï¼‰ã€‚

è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ STL è¯»å–ã€å¤„ç†å’Œå†™å…¥æ–‡ä»¶ï¼ŒåŒæ—¶ä¿æŒæ–‡ä»¶ç¼–ç ä¸å˜ã€‚æ ¹æ®å®é™…æƒ…å†µï¼Œå¯ä»¥ç»“åˆå…¶ä»–åº“æ¥å¤„ç†æ›´å¤æ‚çš„ç¼–ç æ£€æµ‹å’Œè½¬æ¢ä»»åŠ¡ã€‚



æˆ‘æ²¡æœ‰çœ‹åˆ°ä½ å¯¹æœªçŸ¥ç¼–ç çš„æ¼”ç¤º



ğŸ¤–



å¦‚æœéœ€è¦å¤„ç†æœªçŸ¥ç¼–ç çš„æ–‡ä»¶ï¼Œé€šå¸¸éœ€è¦å€ŸåŠ©ç¬¬ä¸‰æ–¹åº“æ¥æ£€æµ‹æ–‡ä»¶çš„ç¼–ç ã€‚C++ æ ‡å‡†åº“ï¼ˆSTLï¼‰æœ¬èº«å¹¶ä¸æä¾›ç¼–ç æ£€æµ‹åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ `uchardet` åº“ï¼ˆä¸€ä¸ªåŸºäº Mozilla Universal Charset Detector çš„ C++ åº“ï¼‰æ¥æ£€æµ‹æ–‡ä»¶ç¼–ç çš„ç¤ºä¾‹ã€‚

### å®‰è£… `uchardet` åº“

åœ¨ä½¿ç”¨ç¤ºä¾‹ä»£ç ä¹‹å‰ï¼Œéœ€è¦å®‰è£… `uchardet` åº“ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å®‰è£…ï¼š

- **Linux**: ä½¿ç”¨åŒ…ç®¡ç†å™¨å®‰è£…ï¼Œä¾‹å¦‚ `sudo apt-get install uchardet`
- **macOS**: ä½¿ç”¨ Homebrew å®‰è£…ï¼Œä¾‹å¦‚ `brew install uchardet`
- **Windows**: éœ€è¦æ‰‹åŠ¨ç¼–è¯‘å’Œå®‰è£…ï¼Œæˆ–è€…ä½¿ç”¨ vcpkg å®‰è£…ã€‚

### ç¤ºä¾‹ä»£ç 

1. **æ£€æµ‹æ–‡ä»¶ç¼–ç **ï¼š

é¦–å…ˆï¼Œæˆ‘ä»¬ç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥æ£€æµ‹æ–‡ä»¶çš„ç¼–ç ï¼š

```
Cpp1#include <uchardet/uchardet.h>
2#include <fstream>
3#include <vector>
4#include <stdexcept>
5#include <string>
6
7std::string detectEncoding(const std::string& filename) {
8    std::ifstream file(filename, std::ios::binary);
9    if (!file) {
10        throw std::runtime_error("Could not open file for reading");
11    }
12
13    std::vector<char> buffer((std::istreambuf_iterator<char>(file)), std::istreambuf_iterator<char>());
14
15    uchardet_t ud = uchardet_new();
16    if (uchardet_handle_data(ud, buffer.data(), buffer.size()) != 0) {
17        uchardet_delete(ud);
18        throw std::runtime_error("Failed to detect encoding");
19    }
20    uchardet_data_end(ud);
21
22    const char* charset = uchardet_get_charset(ud);
23    std::string encoding(charset);
24
25    uchardet_delete(ud);
26    return encoding;
27}
```

1. **è¯»å–æ–‡ä»¶å†…å®¹**ï¼š

æ ¹æ®æ£€æµ‹åˆ°çš„ç¼–ç æ¥è¯»å–æ–‡ä»¶å†…å®¹ã€‚è¿™é‡Œä½¿ç”¨ `iconv` åº“æ¥è¿›è¡Œç¼–ç è½¬æ¢ã€‚

```
Cpp1#include <iconv.h>
2#include <vector>
3#include <iostream>
4
5std::string convertEncoding(const std::string& input, const std::string& fromEncoding, const std::string& toEncoding) {
6    iconv_t cd = iconv_open(toEncoding.c_str(), fromEncoding.c_str());
7    if (cd == (iconv_t)-1) {
8        throw std::runtime_error("Failed to open iconv");
9    }
10
11    size_t inSize = input.size();
12    size_t outSize = inSize * 4;
13    std::vector<char> output(outSize);
14
15    char* inBuf = const_cast<char*>(input.data());
16    char* outBuf = output.data();
17    size_t inBytesLeft = inSize;
18    size_t outBytesLeft = outSize;
19
20    if (iconv(cd, &inBuf, &inBytesLeft, &outBuf, &outBytesLeft) == (size_t)-1) {
21        iconv_close(cd);
22        throw std::runtime_error("Failed to convert encoding");
23    }
24
25    iconv_close(cd);
26    return std::string(output.data(), outSize - outBytesLeft);
27}
28
29std::string readFileWithEncoding(const std::string& filename, const std::string& encoding) {
30    std::ifstream file(filename, std::ios::binary);
31    if (!file) {
32        throw std::runtime_error("Could not open file for reading");
33    }
34
35    std::vector<char> buffer((std::istreambuf_iterator<char>(file)), std::istreambuf_iterator<char>());
36    return convertEncoding(std::string(buffer.data(), buffer.size()), encoding, "UTF-8");
37}
```

1. **å†™å…¥å¤„ç†åçš„å†…å®¹**ï¼š

å°†å¤„ç†åçš„å†…å®¹å†™å›æ–‡ä»¶æ—¶ï¼Œä¿æŒåŸæ¥çš„ç¼–ç ã€‚

```
Cpp1void writeFileWithEncoding(const std::string& filename, const std::string& content, const std::string& encoding) {
2    std::string encodedContent = convertEncoding(content, "UTF-8", encoding);
3
4    std::ofstream file(filename, std::ios::binary);
5    if (!file) {
6        throw std::runtime_error("Could not open file for writing");
7    }
8
9    file.write(encodedContent.data(), encodedContent.size());
10}
```

1. **ä¸»å‡½æ•°**ï¼š

ç¤ºä¾‹ä¸»å‡½æ•°ï¼Œæ¼”ç¤ºå¦‚ä½•æ£€æµ‹æ–‡ä»¶ç¼–ç ã€è¯»å–æ–‡ä»¶ã€å¤„ç†å†…å®¹å¹¶å†™å›æ–‡ä»¶ã€‚

```
Cpp1int main() {
2    try {
3        std::string filename = "example.txt";
4
5        // æ£€æµ‹æ–‡ä»¶ç¼–ç 
6        std::string encoding = detectEncoding(filename);
7        std::cout << "Detected encoding: " << encoding << std::endl;
8
9        // è¯»å–æ–‡ä»¶å†…å®¹å¹¶è½¬æ¢ä¸º UTF-8 ç¼–ç 
10        std::string content = readFileWithEncoding(filename, encoding);
11
12        // å¤„ç†æ–‡ä»¶å†…å®¹ï¼ˆä¾‹å¦‚ï¼Œå°†å†…å®¹è½¬æ¢ä¸ºå¤§å†™ï¼‰
13        std::transform(content.begin(), content.end(), content.begin(), ::toupper);
14
15        // å†™å…¥å¤„ç†åçš„å†…å®¹ï¼Œä¿æŒåŸæ¥çš„ç¼–ç 
16        writeFileWithEncoding("processed_" + filename, content, encoding);
17
18        std::cout << "File processed and written successfully." << std::endl;
19    } catch (const std::exception& e) {
20        std::cerr << "Error: " << e.what() << std::endl;
21    }
22
23    return 0;
24}
```

### æ€»ç»“

è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ `uchardet` åº“æ£€æµ‹æ–‡ä»¶ç¼–ç ï¼Œå¹¶ä½¿ç”¨ `iconv` åº“è¿›è¡Œç¼–ç è½¬æ¢ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥è¯»å–å’Œå¤„ç†æœªçŸ¥ç¼–ç çš„æ–‡ä»¶ï¼Œå¹¶åœ¨å†™å›æ–‡ä»¶æ—¶ä¿æŒåŸæ¥çš„ç¼–ç ã€‚è¯·ç¡®ä¿åœ¨ç¼–è¯‘æ—¶é“¾æ¥ `uchardet` å’Œ `iconv` åº“ã€‚



æ–‡ä»¶æ•°æ®å¹¶éç›´æ¥æ¥è‡ªæ–‡ä»¶, è€Œæ˜¯æ¥è‡ªå·²è¢« libclang Translate è§£æè¿‡çš„å†…å­˜æ•°æ®



ğŸ¤–



å¦‚æœæ–‡ä»¶æ•°æ®æ¥è‡ªå·²è¢« `libclang` è§£æè¿‡çš„å†…å­˜æ•°æ®ï¼Œé‚£ä¹ˆä½ å¯ä»¥è·³è¿‡æ–‡ä»¶è¯»å–éƒ¨åˆ†ï¼Œç›´æ¥å¤„ç†å†…å­˜ä¸­çš„æ•°æ®ã€‚å‡è®¾ä½ å·²ç»æœ‰äº†å†…å­˜ä¸­çš„æ•°æ®ï¼Œå¹¶ä¸”éœ€è¦æ£€æµ‹å…¶ç¼–ç ã€å¤„ç†æ•°æ®å¹¶ä¿æŒç¼–ç ä¸å˜ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ã€‚

### ç¤ºä¾‹ä»£ç 

1. **æ£€æµ‹å†…å­˜æ•°æ®çš„ç¼–ç **ï¼š

å‡è®¾ä½ å·²ç»å°†å†…å­˜æ•°æ®å­˜å‚¨åœ¨ä¸€ä¸ª `std::vector` æˆ– `std::string` ä¸­ï¼Œä½¿ç”¨ `uchardet` æ¥æ£€æµ‹å…¶ç¼–ç ã€‚

```
Cpp1#include <uchardet/uchardet.h>
2#include <vector>
3#include <stdexcept>
4#include <string>
5
6std::string detectEncoding(const std::vector<char>& data) {
7    uchardet_t ud = uchardet_new();
8    if (uchardet_handle_data(ud, data.data(), data.size()) != 0) {
9        uchardet_delete(ud);
10        throw std::runtime_error("Failed to detect encoding");
11    }
12    uchardet_data_end(ud);
13
14    const char* charset = uchardet_get_charset(ud);
15    std::string encoding(charset);
16
17    uchardet_delete(ud);
18    return encoding;
19}
```

1. **å¤„ç†å†…å­˜æ•°æ®**ï¼š

å°†å†…å­˜æ•°æ®è½¬æ¢ä¸º UTF-8ï¼Œå¤„ç†åå†è½¬æ¢å›åŸç¼–ç ã€‚

```
Cpp1#include <iconv.h>
2#include <vector>
3#include <string>
4#include <stdexcept>
5
6std::string convertEncoding(const std::string& input, const std::string& fromEncoding, const std::string& toEncoding) {
7    iconv_t cd = iconv_open(toEncoding.c_str(), fromEncoding.c_str());
8    if (cd == (iconv_t)-1) {
9        throw std::runtime_error("Failed to open iconv");
10    }
11
12    size_t inSize = input.size();
13    size_t outSize = inSize * 4;
14    std::vector<char> output(outSize);
15
16    char* inBuf = const_cast<char*>(input.data());
17    char* outBuf = output.data();
18    size_t inBytesLeft = inSize;
19    size_t outBytesLeft = outSize;
20
21    if (iconv(cd, &inBuf, &inBytesLeft, &outBuf, &outBytesLeft) == (size_t)-1) {
22        iconv_close(cd);
23        throw std::runtime_error("Failed to convert encoding");
24    }
25
26    iconv_close(cd);
27    return std::string(output.data(), outSize - outBytesLeft);
28}
29
30std::string processContent(const std::vector<char>& data, const std::string& encoding) {
31    // å°†æ•°æ®è½¬æ¢ä¸º UTF-8 ç¼–ç 
32    std::string utf8Content = convertEncoding(std::string(data.data(), data.size()), encoding, "UTF-8");
33
34    // å¯¹å†…å®¹è¿›è¡Œå¤„ç†ï¼Œä¾‹å¦‚å°†å†…å®¹è½¬æ¢ä¸ºå¤§å†™
35    std::transform(utf8Content.begin(), utf8Content.end(), utf8Content.begin(), ::toupper);
36
37    // å°†å¤„ç†åçš„å†…å®¹è½¬æ¢å›åŸç¼–ç 
38    return convertEncoding(utf8Content, "UTF-8", encoding);
39}
```

1. **ä¸»å‡½æ•°**ï¼š

ç¤ºä¾‹ä¸»å‡½æ•°ï¼Œæ¼”ç¤ºå¦‚ä½•æ£€æµ‹å†…å­˜æ•°æ®ç¼–ç ã€å¤„ç†æ•°æ®å¹¶ä¿æŒç¼–ç ä¸å˜ã€‚

```
Cpp1#include <iostream>
2#include <vector>
3#include <string>
4
5int main() {
6    try {
7        // å‡è®¾å†…å­˜æ•°æ®å·²è¢« libclang è§£æè¿‡
8        std::vector<char> data = {/* ... å¡«å……æ•°æ® ... */};
9
10        // æ£€æµ‹å†…å­˜æ•°æ®çš„ç¼–ç 
11        std::string encoding = detectEncoding(data);
12        std::cout << "Detected encoding: " << encoding << std::endl;
13
14        // å¤„ç†å†…å­˜æ•°æ®å¹¶ä¿æŒåŸç¼–ç 
15        std::string processedContent = processContent(data, encoding);
16
17        // è¾“å‡ºå¤„ç†åçš„æ•°æ®
18        std::cout << "Processed content: " << processedContent << std::endl;
19
20    } catch (const std::exception& e) {
21        std::cerr << "Error: " << e.what() << std::endl;
22    }
23
24    return 0;
25}
```

### æ€»ç»“

è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•å¤„ç†æ¥è‡ªå†…å­˜ä¸­çš„æ•°æ®ï¼Œè€Œä¸æ˜¯ç›´æ¥ä»æ–‡ä»¶è¯»å–ã€‚é€šè¿‡ä½¿ç”¨ `uchardet` åº“æ£€æµ‹ç¼–ç ï¼Œå¹¶ä½¿ç”¨ `iconv` åº“è¿›è¡Œç¼–ç è½¬æ¢ï¼Œå¯ä»¥åœ¨å¤„ç†æ•°æ®æ—¶ä¿æŒåŸæ¥çš„ç¼–ç ã€‚è¯·ç¡®ä¿åœ¨ç¼–è¯‘æ—¶é“¾æ¥ `uchardet` å’Œ `iconv` åº“ã€‚